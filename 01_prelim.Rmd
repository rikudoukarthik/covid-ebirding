---
title: "COVID eBirding: Preliminary analyses"
date: "2021/12/01"
author: "Karthik Thrikkadeeri"
editor_options: 
  chunk_output_type: console
bibliography: covid-ebirding.bib
link-citations: yes
output: 
  html_document:
    toc: true
    toc_depth: 3  
    number_sections: false  
    theme: united  # many options for theme, this one is my favorite.
    highlight: tango  # specifies the syntax highlighting style
---

```{r setup, include=FALSE}
library(tidyverse)
library(lubridate)
library(patchwork)
theme_set(theme_bw())
```

```{r data_filt, cache=TRUE, echo=FALSE}
### importing from modified ebd RData
load("data/ebd_IN_relSep-2021.RData") 

### list of group accounts to be filtered
groupaccs <- read.csv("data/ebd_users_GA_relSep-2021.csv", 
                      na.strings = c(""," ",NA), quote = "", header = T, 
                      nrows = 401)  # excluding empty cells
groupaccs <- groupaccs %>% 
  mutate(CATEGORY = case_when(GA.1 == 1 ~ "GA.1", 
                              GA.2 == 1 ~ "GA.2", 
                              TRUE ~ "NG"))
filtGA <- groupaccs %>% filter(CATEGORY == "GA.1") %>% select(OBSERVER.ID)



### new observer data
new_obsr_data <- data %>% 
  select(c("YEAR", "MONTH", "STATE", "SAMPLING.EVENT.IDENTIFIER",
           "LAST.EDITED.DATE", "OBSERVER.ID")) %>% 
  mutate(LAST.EDITED.DATE = ymd_hms(LAST.EDITED.DATE)) %>% 
  group_by(OBSERVER.ID) %>% 
  arrange(LAST.EDITED.DATE) %>% 
  ungroup() %>% 
  distinct(OBSERVER.ID, .keep_all = TRUE) %>%
  mutate(LE.YEAR = year(LAST.EDITED.DATE),
         LE.MONTH = month(LAST.EDITED.DATE)) %>% 
  mutate(COVID = case_when(LE.YEAR %in% c(2018,2019) ~ "BEF", 
                           LE.YEAR %in% c(2020,2021) ~ "DUR",
                           TRUE ~ "NA")) 

# filtering
new_obsr_data <- new_obsr_data %>% anti_join(filtGA) 

save(new_obsr_data, file = "data/new_obsr_data.RData")


### main data
data <- data %>% filter(YEAR >= 2018) 
save(data, file = "data/rawdata.RData")

# filters
data0 <- data %>% anti_join(filtGA) %>% 
  filter(PROTOCOL.TYPE %in% c("Traveling","Stationary"))

rm(list = setdiff(ls(envir = .GlobalEnv), c("data0")), pos = ".GlobalEnv")
save.image("data/data0.RData")

# random subset for analysis + adding COVID category
set.seed(10)
data_sub <- data0 %>% 
  filter(GROUP.ID %in% sample(unique(data0$GROUP.ID),100000)) %>% 
  mutate(COVID = case_when(YEAR %in% c(2017,2018,2019) ~ "BEF", TRUE ~ "DUR"))
save(data_sub, file = "data/data_sub.RData")
```

```{r data_load, cache=TRUE, dependson="data_filt", echo=FALSE}
load("data/data_sub.RData")
```


# Introduction

This study will focus on the impacts of the COVID-19 pandemic on both birds and the birding community in the Indian context. It will also try to understand the consequences of these changes on citizen science and the inferences that can be drawn from it. Lastly, it will propose guidelines for making the most of the available data while accounting for pandemic-driven biases and deviations from the pre-COVID normal. 

To ensure a balanced time frame, this study will focus on the years from 2018 to 2021. The time period of 2018–19 will be considered as “pre-COVID” while 2020–21 will be considered “COVID”. In order to account for within-year variations in bird and birder behaviour, the comparisons will be made on the month level. For instance, various metrics of birding behaviour in the month of June will be compared between 2018–19 and 2020–21, and will not be confounded with patterns seen in other months. 

## Questions

Are there any changes and gaps in the pandemic eBird data? These questions will be answered using numerous metrics calculated from the focal data point in eBird data, a checklist.

- What has happened to overall birding activity? 

- What has happened to group birding? Has it decreased, as would be expected?

- Has birding effort changed with the pandemic? 

- Are there biases in the pandemic birding activity in terms of spatial and temporal spread?


# Preliminary analyses

***This notebook is the preliminary analysis notebook for the study. Here, I explore, mainly via visualisations, the basic patterns in the data.***

Among other filters applied, the data being used is a random subset (100,000 unique lists) of the full data, in order to reduce storage and computational demands.


## COVID timeline at national and state levels

### National level

#### Waves:  

```{r nationalwaves, echo=FALSE}
nwaves <- read.csv("data/covid_19_india.csv")
nwaves <- nwaves %>% mutate(date = as.Date(date, "%d/%m/%Y")) %>% 
  group_by(date) %>% summarise(cases = sum(cases))
nwaves <- nwaves %>% mutate(tot_cases = cases, 
                            cases = cases - lag(cases, default = 0))

ggplot(nwaves, aes(date, cases)) + geom_line() +
  scale_y_continuous(labels = scales::label_comma()) +
    ggtitle("New COVID cases (as of Aug 2021)") +
  xlab("Date") + ylab("Cases") +
  theme(axis.text.y = element_text(angle = 90),
        axis.title.y = element_text(vjust = 3))

```

While there is no strict definition for a "wave" or "phase" of an epidemic [@wagnerWhatMakesWave], here we use the general connotation of a natural pattern of sharply defined peaks and valleys in the number of sick/infected individuals. As such, India has experienced two waves at the national level [see @worldhealthorganizationIndiaWHOCoronavirus].  

1. July 2020--December 2021  
2. March 2021--June 2021

#### Lockdowns:  

```{r, echo=FALSE}
knitr::include_graphics("pics/lox.png")
```

1. 24 March 2020--31 May 2020 [@CoronavirusIndiaEnters2020; @gettlemanModiOrders3Week2020; @banerjeaCoronavirusLockdownExtended2020; @LockdownGuidelinesNationwide2020]  
2. Second phase: The second wave of the pandemic in India has seen no nationwide lockdown [@Covid19SecondWave2021; @sangalAnalysisAnotherNational2021].

#### Vaccination drives:  

1. March 2021--June 2021  
2. July 2021--mid-Aug 2021 (end of data)

```{r vax, echo=FALSE}
vax <- read.csv("data/covid_vaccine_statewise.csv", as.is=F)
vax <- mutate(vax, date = as.Date(date, "%d/%m/%Y"))
ggplot(filter(vax, state == "India"), aes(date, dose2)) + geom_line() +
  scale_y_continuous(labels = scales::label_comma()) +
  ggtitle("Second vaccine doses administered (as of Aug 2021)") +
  xlab("Date") + ylab("Doses") +
  theme(axis.text.y = element_text(angle = 90),
        axis.title.y = element_text(vjust = 3))
```


The lower plateau of the second dose vaccinations is certainly post mid-August, so we will use data from September onwards as control, to compare with DURING. 

### State level


```{r states, echo=FALSE}
states <- read.csv("data/covid_19_india.csv")
states <- states %>% mutate(date = as.Date(date, "%d/%m/%Y"))
states <- states %>% group_by(state) %>% 
  mutate(tot_cases = cases, 
         cases = cases - lag(cases, default = 0))
```


#### Kerala

```{r states_KL, echo=FALSE}
ggplot(filter(states, state == "Kerala"), aes(date, cases)) + geom_line()
```

##### Waves:  
1. September 2020--November 2020
2. January 2021--March 2021  
3. April 2021--June 2021
4. August 2021--August 2021 (end of data)

##### Lockdowns:  
1. 24 March 2020--31 May 2020
2. March 2021--April 2021  
[@GoKDashboardOfficial]

#### Karnataka

```{r states_KA, echo=FALSE}
ggplot(filter(states, state == "Karnataka"), aes(date, cases)) + geom_line()
```

##### Waves:  
1. July 2020--November 2020  
2. April 2021--June 2021

##### Lockdowns:  
1. 24 March 2020--31 May 2020
2. May 2021--May 2021 [@Covid19SecondWave2021]  
3. August 2021--September 2021 (some districts) [@KarnatakaImposesWeekend2021]

#### Tamil Nadu

```{r states_TN, echo=FALSE}
ggplot(filter(states, state == "Tamil Nadu"), aes(date, cases)) + geom_line()
```

##### Waves:  
1. June 2020--November 2020  
2. April 2021--July 2021

##### Lockdowns:  
1. 24 March 2020--31 May 2020

#### Maharashtra

```{r states_MH, echo=FALSE}
ggplot(filter(states, state == "Maharashtra"), aes(date, cases)) + geom_line()
```

##### Waves:  
1. July 2020--November 2020  
2. March 2021--June 2021

##### Lockdowns:  
1. 24 March 2020--31 May 2020
2. April 2021--May 2021 [@Covid19SecondWave2021]  

#### Gujarat

```{r states_GJ, echo=FALSE}
ggplot(filter(states, state == "Gujarat"), aes(date, cases)) + geom_line()
```

##### Waves:  
1. April 2021--June 2021  

##### Lockdowns:  
1. 24 March 2020--31 May 2020  
2. April 2021--June 2021 (only night curfew + other restrictions) [@LockdownGujaratNight2021; @GujaratCOVID19Restrictions2021]
No state lockdowns. Only curfews and other restrictions. [@Covid19SecondWave2021]

#### Maharashtra

```{r states_AR, echo=FALSE}
ggplot(filter(states, state == "Maharashtra"), aes(date, cases)) + geom_line()
```

##### Waves:  
1. August 2020--December 2020   
2. May 2021--August 2021 (end of data)

##### Lockdowns:  
1. 24 March 2020--31 May 2020
2. 

#### West Bengal

```{r states_WB, echo=FALSE}
ggplot(filter(states, state == "West Bengal"), aes(date, cases)) + geom_line()
```

##### Waves:  
1. July 2020--January 2021  
2. April 2021--July 2021

##### Lockdowns:  
1. 24 March 2020--31 May 2020
2. 

#### Sikkim

```{r states_SI, echo=FALSE}
ggplot(filter(states, state == "Sikkim"), aes(date, cases)) + geom_line()
```

##### Waves:  
1. April 2021--June 2021  
2. July 2021--August 2021 (end of data)

##### Lockdowns:  
1. 24 March 2020--31 May 2020
2. 

#### Uttarakhand

```{r states_UK, echo=FALSE}
ggplot(filter(states, state == "Uttarakhand"), aes(date, cases)) + geom_line()
```

##### Waves:  
1. August 2020--November 2020  
2. December 2020--January 2021
3. April 2021--June 2021

##### Lockdowns:  
1. 24 March 2020--31 May 2020
2. 




## Birder behaviour (focus level: checklists)

Changes in eBirder behaviour will be analysed using the focal data point, checklists. A number of metrics based on checklists will be calculated and analysed (**at the monthly scale**), such as:

1. Number of submitted checklists  
1.1. Total lists  
1.1. Shared lists (use no. of obs.)  
1. Number of submitted checklists per observer  
1.1. Total lists  
1.1. Shared lists (use no. of obs.)  
1. Hotspot birding  
1. Birding protocol  
1. Birding distance
1. Site fidelity per observer  
1. Habitats surveyed  
1. Spatial spread of birding activity. These spatial patterns will be explored at two scales too: nationwide and regional.  
1.1. Spatial spread by absences  
1.1. Spatial spread by densities  
1. List duration
1. List length  
1. Birding time per observer (monthly for prelim, later maybe daily)  
1. Temporal spread of birding activity  
1.1. Temporal spread within day (time-of-day)  
1.1. Temporal spread within week (day-of-week)  
1. Media  
1. Number of new birders

When running the actual models, observer will be used as a random effect because all of these metrics would vary differently from observer to observer.

Aside from comparing trends before and during the pandemic, at a finer scale we will also try to find patterns matching the various waves of spread and complete lockdown, as well as the vaccination progress.

Pot-presentation: regarding averaging national level patterns by state for some metrics, this means that means are manually calculated for states and the points plotted in the graph are only these single points per state (instead of all the raw data points).


### Number of submitted lists

Includes "duplicate" shared lists, of course.

```{r no_lists, cache=TRUE, message=FALSE, echo=FALSE}
temp1 <- data_sub %>% 
  group_by(SAMPLING.EVENT.IDENTIFIER) %>% 
  slice(1) %>% ungroup() %>% 
  group_by(YEAR, MONTH, STATE) %>% 
  summarise(NO.LISTS = n_distinct(SAMPLING.EVENT.IDENTIFIER), COVID = min(COVID)) %>%
  ungroup() 

temp2 <- data_sub %>% 
  group_by(SAMPLING.EVENT.IDENTIFIER) %>% 
  slice(1) %>% ungroup() %>% 
  filter(NUMBER.OBSERVERS > 1) %>% 
  group_by(YEAR, MONTH, STATE) %>% 
  summarise(NO.SLISTS = n_distinct(SAMPLING.EVENT.IDENTIFIER), COVID = min(COVID)) %>%
  ungroup() 

nl_sw <- left_join(temp1, temp2)
rm(list = c("temp1","temp2"))

temp1 <- data_sub %>% 
  group_by(SAMPLING.EVENT.IDENTIFIER) %>% 
  slice(1) %>% ungroup() %>% 
  group_by(YEAR, MONTH) %>% 
  summarise(NO.LISTS = n_distinct(SAMPLING.EVENT.IDENTIFIER), COVID = min(COVID)) %>%
  ungroup() 

temp2 <- data_sub %>% 
  group_by(SAMPLING.EVENT.IDENTIFIER) %>% 
  slice(1) %>% ungroup() %>% 
  filter(NUMBER.OBSERVERS > 1) %>% 
  group_by(YEAR, MONTH) %>% 
  summarise(NO.SLISTS = n_distinct(SAMPLING.EVENT.IDENTIFIER), COVID = min(COVID)) %>%
  ungroup() 

nl_nw <- left_join(temp1, temp2)
rm(list = c("temp1","temp2"))

nl_sw <- nl_sw %>% 
  mutate(NO.SLISTS = ifelse(is.na(NO.SLISTS), 0, NO.SLISTS)) %>% 
  mutate(PROP.SLISTS = round(NO.SLISTS/NO.LISTS,2))
nl_nw <- nl_nw %>% 
  mutate(NO.SLISTS = ifelse(is.na(NO.SLISTS), 0, NO.SLISTS)) %>% 
  mutate(PROP.SLISTS = round(NO.SLISTS/NO.LISTS,2))


(ggplot(nl_nw, aes(COVID, NO.LISTS, group = COVID)) + 
  scale_y_log10() + 
  geom_point(stat = "summary", fun.data = mean_cl_boot, size = 4) + 
  geom_errorbar(stat = 'summary', fun.data = mean_cl_boot, size = 1.25, width = 0.1) +
  xlab("COVID") + ylab("Total lists") |
ggplot(nl_nw, aes(COVID, NO.SLISTS, group = COVID)) + 
  scale_y_log10() + 
  geom_point(stat = "summary", fun.data = mean_cl_boot, size = 4) + 
  geom_errorbar(stat = 'summary', fun.data = mean_cl_boot, size = 1.25, width = 0.1) +
  xlab("COVID") + ylab("Shared lists")) /
(ggplot(nl_nw, aes(MONTH, PROP.SLISTS, colour = COVID)) + 
  scale_x_continuous(breaks = 1:12) + geom_point(size = 2)) +
plot_annotation(title = "Change in no. of lists with pandemic at national level")


(ggplot(filter(nl_sw, STATE == "Kerala"), aes(COVID, NO.LISTS, group = COVID)) + 
  scale_y_log10() + 
  geom_point(stat = "summary", fun.data = mean_cl_boot, size = 4) + 
  geom_errorbar(stat = 'summary', fun.data = mean_cl_boot, size = 1.25, width = 0.1) +
  xlab("COVID") + ylab("Total lists") |
ggplot(filter(nl_sw, STATE == "Kerala"), aes(COVID, NO.SLISTS, group = COVID)) + 
  scale_y_log10() + 
  geom_point(stat = "summary", fun.data = mean_cl_boot, size = 4) + 
  geom_errorbar(stat = 'summary', fun.data = mean_cl_boot, size = 1.25, width = 0.1) +
  xlab("COVID") + ylab("Shared lists")) /
(ggplot(filter(nl_sw, STATE == "Kerala"), aes(MONTH, PROP.SLISTS, colour = COVID)) + 
  scale_x_continuous(breaks = 1:12) + geom_point(size = 2)) +
plot_annotation(title = "Change in no. of lists with pandemic in Kerala")


(ggplot(filter(nl_sw, STATE == "Karnataka"), aes(COVID, NO.LISTS, group = COVID)) + 
  scale_y_log10() + 
  geom_point(stat = "summary", fun.data = mean_cl_boot, size = 4) + 
  geom_errorbar(stat = 'summary', fun.data = mean_cl_boot, size = 1.25, width = 0.1) +
  xlab("COVID") + ylab("Total lists") |
ggplot(filter(nl_sw, STATE == "Karnataka"), aes(COVID, NO.SLISTS, group = COVID)) + 
  scale_y_log10() + 
  geom_point(stat = "summary", fun.data = mean_cl_boot, size = 4) + 
  geom_errorbar(stat = 'summary', fun.data = mean_cl_boot, size = 1.25, width = 0.1) +
  xlab("COVID") + ylab("Shared lists")) /
(ggplot(filter(nl_sw, STATE == "Karnataka"), aes(MONTH, PROP.SLISTS, colour = COVID)) + 
  scale_x_continuous(breaks = 1:12) + geom_point(size = 2)) +
plot_annotation(title = "Change in no. of lists with pandemic in Karnataka")


(ggplot(filter(nl_sw, STATE == "Gujarat"), aes(COVID, NO.LISTS, group = COVID)) + 
  scale_y_log10() + 
  geom_point(stat = "summary", fun.data = mean_cl_boot, size = 4) + 
  geom_errorbar(stat = 'summary', fun.data = mean_cl_boot, size = 1.25, width = 0.1) +
  xlab("COVID") + ylab("Total lists") |
ggplot(filter(nl_sw, STATE == "Gujarat"), aes(COVID, NO.SLISTS, group = COVID)) + 
  scale_y_log10() + 
  geom_point(stat = "summary", fun.data = mean_cl_boot, size = 4) + 
  geom_errorbar(stat = 'summary', fun.data = mean_cl_boot, size = 1.25, width = 0.1) +
  xlab("COVID") + ylab("Shared lists")) /
(ggplot(filter(nl_sw, STATE == "Gujarat"), aes(MONTH, PROP.SLISTS, colour = COVID)) + 
  scale_x_continuous(breaks = 1:12) + geom_point(size = 2)) +
plot_annotation(title = "Change in no. of lists with pandemic in Gujarat")


(ggplot(filter(nl_sw, STATE == "Maharashtra"), aes(COVID, NO.LISTS, group = COVID)) + 
  scale_y_log10() + 
  geom_point(stat = "summary", fun.data = mean_cl_boot, size = 4) + 
  geom_errorbar(stat = 'summary', fun.data = mean_cl_boot, size = 1.25, width = 0.1) +
  xlab("COVID") + ylab("Total lists") |
ggplot(filter(nl_sw, STATE == "Maharashtra"), aes(COVID, NO.SLISTS, group = COVID)) + 
  scale_y_log10() + 
  geom_point(stat = "summary", fun.data = mean_cl_boot, size = 4) + 
  geom_errorbar(stat = 'summary', fun.data = mean_cl_boot, size = 1.25, width = 0.1) +
  xlab("COVID") + ylab("Shared lists")) /
(ggplot(filter(nl_sw, STATE == "Maharashtra"), aes(MONTH, PROP.SLISTS, colour = COVID)) + 
  scale_x_continuous(breaks = 1:12) + geom_point(size = 2)) +
plot_annotation(title = "Change in no. of lists with pandemic in Maharashtra")

rm(list = c("nl_sw","nl_nw"))

```

* In Kerala, overall birding (no. of lists) did not show as great of an increase as at the national level, but shared lists drastically during the pandemic, and especially lowered during April--May which coincided with lockdowns roughly in the two years. Therefore, growth in eBirding was not very high, but group birding decreased.  
* Karnataka saw very high growth in eBirding in terms of no. of lists submitted, but group birding also increased during the pandemic. Monthwise proportion of shared lists wasn't notably different before and during.  
* Gujarat showed similar patterns to Karnataka, but to a lower extent. Monthwise proportion of shared lists wasn't notably different before and during, except for April--May when there were very few shared lists.  
* For Arunachal Pradesh, there isn't enough data to make conclusion. Some months have no lists submitted and these cases are total mysteries, while for months with some (limited) data,  monthwise proportions of shared lists weren't notably different.

### Number of submitted lists per observer

Includes "duplicate" shared lists, of course.

```{r no_lists_po, cache=TRUE, message=FALSE, echo=FALSE}
temp1 <- data_sub %>% 
  group_by(SAMPLING.EVENT.IDENTIFIER) %>% 
  slice(1) %>% ungroup() %>% 
  group_by(YEAR, MONTH, STATE, OBSERVER.ID) %>% 
  summarise(NO.LISTS = n_distinct(SAMPLING.EVENT.IDENTIFIER), COVID = min(COVID)) %>%
  ungroup() 

temp2 <- data_sub %>% 
  group_by(SAMPLING.EVENT.IDENTIFIER) %>% 
  slice(1) %>% ungroup() %>% 
  filter(NUMBER.OBSERVERS > 1) %>% 
  group_by(YEAR, MONTH, STATE, OBSERVER.ID) %>% 
  summarise(NO.SLISTS = n_distinct(SAMPLING.EVENT.IDENTIFIER), COVID = min(COVID)) %>%
  ungroup() 

nl_po_sw <- left_join(temp1, temp2)
rm(list = c("temp1","temp2"))

temp1 <- data_sub %>% 
  group_by(SAMPLING.EVENT.IDENTIFIER) %>% 
  slice(1) %>% ungroup() %>% 
  group_by(YEAR, MONTH, OBSERVER.ID) %>% 
  summarise(NO.LISTS = n_distinct(SAMPLING.EVENT.IDENTIFIER), COVID = min(COVID)) %>%
  ungroup() 

temp2 <- data_sub %>% 
  group_by(SAMPLING.EVENT.IDENTIFIER) %>% 
  slice(1) %>% ungroup() %>% 
  filter(NUMBER.OBSERVERS > 1) %>% 
  group_by(YEAR, MONTH, OBSERVER.ID) %>% 
  summarise(NO.SLISTS = n_distinct(SAMPLING.EVENT.IDENTIFIER), COVID = min(COVID)) %>%
  ungroup() 

nl_po_nw <- left_join(temp1, temp2)
rm(list = c("temp1","temp2"))

nl_po_sw <- nl_po_sw %>% 
  mutate(NO.SLISTS = ifelse(is.na(NO.SLISTS), 0, NO.SLISTS)) %>% 
  mutate(PROP.SLISTS = round(NO.SLISTS/NO.LISTS,2))
nl_po_nw <- nl_po_nw %>% 
  mutate(NO.SLISTS = ifelse(is.na(NO.SLISTS), 0, NO.SLISTS)) %>% 
  mutate(PROP.SLISTS = round(NO.SLISTS/NO.LISTS,2))

(ggplot(nl_po_nw, aes(MONTH, PROP.SLISTS, colour = COVID)) + 
  scale_x_continuous(breaks = 1:12) + geom_smooth()) +
plot_annotation(title = "Change in no. of lists per observer with pandemic at national level")

(ggplot(filter(nl_po_sw, STATE == "Kerala"), aes(MONTH, PROP.SLISTS, colour = COVID)) + 
  scale_x_continuous(breaks = 1:12) + geom_smooth()) +
plot_annotation(title = "Change in no. of lists per observer with pandemic in Kerala")

(ggplot(filter(nl_po_sw, STATE == "Karnataka"), aes(MONTH, PROP.SLISTS, colour = COVID)) + 
  scale_x_continuous(breaks = 1:12) + geom_smooth()) +
plot_annotation(title = "Change in no. of lists per observer with pandemic in Karnataka")

(ggplot(filter(nl_po_sw, STATE == "Gujarat"), aes(MONTH, PROP.SLISTS, colour = COVID)) + 
  scale_x_continuous(breaks = 1:12) + geom_smooth()) +
plot_annotation(title = "Change in no. of lists per observer with pandemic in Gujarat")

(ggplot(filter(nl_po_sw, STATE == "Maharashtra"), aes(MONTH, PROP.SLISTS, colour = COVID)) + 
  scale_x_continuous(breaks = 1:12) + geom_smooth()) +
plot_annotation(title = "Change in no. of lists per observer with pandemic in Maharashtra")

rm(list = c("nl_po_sw","nl_po_nw"))

```

* At the national level, it is hard to see patterns using the box/violin plots for lists per observer simply because a huge number of observers fall in the 0--5 range. However, comparing shared lists per observer using the violin plot shows that the right skew in the distribution of data increased greatly, meaning that on average observers made less shared checklists during the pandemic. For the monthwise comparisons, I used smoothing because plotting points for each observer cluttered the graph. The smoothed lines show a beautiful and significant dip in proportion of group birding activities in April--May, i.e., the nationwide lockdown, after which it slowly picked back up. Overall, group birding was less common during the pandemic than before.  
* In Kerala, average birding activity of observers did not change drastically, but group birding per observer decreased slightly (mirroring the national level pattern). Monthwise, in general group birding was less common than before the pandemic; this is especially true during the period of national and state lockdowns (April--May), where it is lower than even expected from the general trend.  
* Karnataka saw a growth in birding, in the sense that the average observer birded more (submitted more lists per month) during the pandemic than before. The difference in group birding before and during the pandemic is minimal overall. When explored at the level of month, it is evident that group birding saw a massive decline mostly during the period of the national lockdown, but was surprisingly similar to the levels before the pandemic during other months! Perhaps birders in Karnataka cared much less about the pandemic than those in Kerala, or, more likely, this could simply be reflecting the difference in implementations of regulations in the two states.  
* Gujarat overall has much less birding activity than the previous two states. It is hard to tell whether the average birder has started birding more or less during the pandemic. The graph seems to suggest that before the pandemic, there were many "tagalong" observers, leading to a relatively high and constant proportion of group birding per observer. This could have been some expert-led bird walks or bird tours, which dominated the entire data coming from the state. However, since the onset of the pandemic, this dominance has diffused, with more observers seemingly starting to explore on their own or with few others. During the national lockdown, group birding drastically reduced, but sharply rose back up again for the onset of winter.  
* Due to scarcity of data from Arunachal Pradesh, it is once again hard to come to conclusions. However, it does indeed look like people started to bird alone more. 


### Hotspot birding  

Not sure if we should explore this metric "per observer"; I think it isn't necessary. Includes duplicate lists, of course.

```{r hotspot, cache=TRUE, message=FALSE, echo=FALSE}

hot_sw <- data_sub %>% 
  group_by(SAMPLING.EVENT.IDENTIFIER) %>% 
  slice(1) %>% ungroup() %>% 
  group_by(YEAR, MONTH, STATE, LOCALITY.TYPE) %>% 
  summarise(NO.LISTS = n_distinct(SAMPLING.EVENT.IDENTIFIER), COVID = min(COVID)) %>%
  ungroup() %>% group_by(COVID) %>% 
  complete(YEAR, MONTH, STATE, LOCALITY.TYPE, fill = list(NO.LISTS = 0)) %>% 
  ungroup() %>% group_by(COVID, YEAR, MONTH, STATE) %>% 
  pivot_wider(names_from = LOCALITY.TYPE, values_from = NO.LISTS) %>% 
  mutate(PROP.H = if_else(H == 0 | P ==0,
                          0,
                          round(H/(H+P),2)), 
         PROP.P = if_else(H == 0 | P ==0,
                          0,
                          round(P/(H+P),2)))

hot_nw <- hot_sw %>% ungroup() %>% 
  filter(!(H == 0 & P == 0)) %>% 
  group_by(COVID, YEAR, MONTH) %>% 
  summarise(H = ceiling(mean(H)),
            P = ceiling(mean(P)),
            PROP.H = if_else(H == 0 | P ==0,
                             0,
                             round(H/(H+P),2)), 
            PROP.P = if_else(H == 0 | P ==0,
                             0,
                             round(P/(H+P),2)))

# Daman and Diu lists not appearing from 2020--2021


(ggplot(hot_nw, aes(MONTH, PROP.H, colour = COVID)) + 
  scale_x_continuous(breaks = 1:12) + geom_point(size = 2) +
  ggtitle("Proportion of lists from hotspots at national level")) /
((ggplot(filter(hot_sw, STATE == "Kerala"), aes(MONTH, PROP.H, colour = COVID)) + 
  scale_x_continuous(breaks = 1:12) + geom_point(size = 2) +
  ggtitle("Kerala")) |
(ggplot(filter(hot_sw, STATE == "Karnataka"), aes(MONTH, PROP.H, colour = COVID)) + 
  scale_x_continuous(breaks = 1:12) + geom_point(size = 2) +
  ggtitle("Karnataka"))) /
((ggplot(filter(hot_sw, STATE == "Gujarat"), aes(MONTH, PROP.H, colour = COVID)) + 
  scale_x_continuous(breaks = 1:12) + geom_point(size = 2) +
  ggtitle("Gujarat")) |
(ggplot(filter(hot_sw, STATE == "Maharashtra"), aes(MONTH, PROP.H, colour = COVID)) + 
  scale_x_continuous(breaks = 1:12) + geom_point(size = 2) +
  ggtitle("Maharashtra")))

rm(list = c("hot_nw","hot_sw"))

```

There seems to be no difference in birding effort between hotspots and personal locations, before and during the pandemic.

### Birding protocol  

```{r protocol, cache=TRUE, message=FALSE, echo=FALSE}

prot_sw <- data_sub %>% 
  group_by(SAMPLING.EVENT.IDENTIFIER) %>% 
  slice(1) %>% ungroup() %>% 
  group_by(YEAR, MONTH, STATE, PROTOCOL.TYPE) %>% 
  summarise(NO.LISTS = n_distinct(SAMPLING.EVENT.IDENTIFIER), COVID = min(COVID)) %>%
  ungroup() %>% group_by(COVID) %>% 
  complete(YEAR, MONTH, STATE, PROTOCOL.TYPE, fill = list(NO.LISTS = 0)) %>% 
  ungroup() %>% group_by(COVID, YEAR, MONTH, STATE) %>% 
  pivot_wider(names_from = PROTOCOL.TYPE, values_from = NO.LISTS) %>% 
  mutate(PROP.S = if_else(Stationary == 0 | Traveling ==0,
                          0,
                          round(Stationary/(Stationary+Traveling),2)),
         PROP.T = if_else(Stationary == 0 | Traveling ==0,
                          0,
                          round(Traveling/(Stationary+Traveling),2)))

prot_nw <- prot_sw %>% ungroup() %>% 
  filter(!(Stationary == 0 & Traveling == 0)) %>% 
  group_by(COVID, YEAR, MONTH) %>% 
  summarise(Stationary = ceiling(mean(Stationary)),
            Traveling = ceiling(mean(Traveling)),
            PROP.S = if_else(Stationary == 0 | Traveling ==0,
                          0,
                          round(Stationary/(Stationary+Traveling),2)),
            PROP.T = if_else(Stationary == 0 | Traveling ==0,
                          0,
                          round(Traveling/(Stationary+Traveling),2)))

# Daman and Diu lists not appearing from 2020--2021

(ggplot(prot_nw, aes(MONTH, PROP.S, colour = COVID)) + 
  scale_x_continuous(breaks = 1:12) + geom_point(size = 2) +
  ggtitle("Proportion of stationary lists at national level")) /
((ggplot(filter(prot_sw, STATE == "Kerala"), aes(MONTH, PROP.S, colour = COVID)) + 
  scale_x_continuous(breaks = 1:12) + geom_point(size = 2) +
  ggtitle("Kerala")) |
(ggplot(filter(prot_sw, STATE == "Karnataka"), aes(MONTH, PROP.S, colour = COVID)) + 
  scale_x_continuous(breaks = 1:12) + geom_point(size = 2) +
  ggtitle("Karnataka"))) /
((ggplot(filter(prot_sw, STATE == "Gujarat"), aes(MONTH, PROP.S, colour = COVID)) + 
  scale_x_continuous(breaks = 1:12) + geom_point(size = 2) +
  ggtitle("Gujarat")) |
(ggplot(filter(prot_sw, STATE == "Maharashtra"), aes(MONTH, PROP.S, colour = COVID)) + 
  scale_x_continuous(breaks = 1:12) + geom_point(size = 2) +
  ggtitle("Maharashtra")))

rm(list = c("prot_nw","prot_sw"))

```

* At the national level, there is an overall pattern in proportion of stationary lists: birders make point counts to a greater extent during the monsoon, when moving outdoors becomes difficult, whereas in the winter stationary lists account for a very tiny fraction of overall lists submitted, because the weather becomes more favourable and people are out in search of migrants. It is interesting to note that despite this pattern, there is no noticeable difference between birding in hotspots and in personal locations. While this mid-year peak in proportion of stationary lists is consistent over the years (even during the pandemic), we see a marked difference in the months of April and May, and to a lesser extent during the monsoon months, in one particular year. This is most likely due to the strict nationwide lockdown implemented in 2020 during these months to curb the spread of the disease. People are likely to have done most birding from their homes. (There being no difference in hotspot birding could possibly be because of many people having their home locations as eBird hotspots.)  
* The same general pattern is observed in individual states to varying degrees.  
* In Kerala, which sees a very strong monsoon, the overall mid-year peak is very distinct. An additional noteworthy point is that the winter months of November and December see greater proportion of stationary lists compared to January and February. This represents some sort of latency in shifting from the monsoon birding mode to migrant-searching mode, although this could simply be due to the fact that migration is not complete yet in November and December. Compared to the national level, Kerala experienced a higher shift in stationary list proportions during the pandemic, evenly through the year, but the sharp increase in April and May extending through the monsoon was seen here too.   
* In Karnataka, the overall mid-year peak was not as strong, because the Western Ghats comprises a relatively smaller area of the state and most of the birding in Karnataka happens in and around metros like Bangalore. Similarly, the shift in proportions with the pandemic was not very significant, except for the months of April and May, that too only in one year (due to the national lockdown in 2020). This agrees with the previous observation that implementation of restrictions was generally more lax in Karnataka than in Kerala.  
* There is no noticeable mid-year peak in Gujarat, which makes sense because the state does not experience a strong monsoon (although it is to be noted that Gujarat has less overall birding compared to the previous states). However, it still saw the spike in proportion of stationary lists during April-May due to the national lockdown.  
* Arunachal once again shows erratic patterns because of scarcity of data, not allowing us to make inferences. 


### Birding distance

```{r distance, cache=TRUE, message=FALSE, echo=FALSE}

dist_sw <- data_sub %>% 
  group_by(SAMPLING.EVENT.IDENTIFIER) %>% 
  slice(1) %>% ungroup() %>% 
  filter(PROTOCOL.TYPE == "Traveling",
         !is.na(EFFORT.DISTANCE.KM))

dist_nw <- dist_sw %>% 
  group_by(COVID, YEAR, MONTH) %>% 
  summarise(EFFORT.DISTANCE.KM = mean(EFFORT.DISTANCE.KM)) %>% 
  ungroup()

(ggplot(dist_nw, aes(MONTH, EFFORT.DISTANCE.KM, colour = COVID)) + 
  scale_y_log10() + scale_x_continuous(breaks = 1:12) + geom_smooth() +
  ggtitle("Average distance travelled at national level") +
  xlab("Month") + ylab("Distance travelled (km)")) /
((ggplot(filter(dist_sw, STATE == "Kerala"), 
       aes(MONTH, EFFORT.DISTANCE.KM, colour = COVID)) + 
  scale_y_log10() + scale_x_continuous(breaks = 1:12) + geom_smooth() +
  ggtitle("Kerala") +
  xlab("Month") + ylab("Distance travelled (km)")) |
(ggplot(filter(dist_sw, STATE == "Karnataka"), 
       aes(MONTH, EFFORT.DISTANCE.KM, colour = COVID)) + 
  scale_y_log10() + scale_x_continuous(breaks = 1:12) + geom_smooth() +
  ggtitle("Karnataka") +
  xlab("Month") + ylab("Distance travelled (km)"))) /
((ggplot(filter(dist_sw, STATE == "Gujarat"), 
       aes(MONTH, EFFORT.DISTANCE.KM, colour = COVID)) + 
  scale_y_log10() + scale_x_continuous(breaks = 1:12) + geom_smooth() +
  ggtitle("Gujarat") +
  xlab("Month") + ylab("Distance travelled (km)")) |
(ggplot(filter(dist_sw, STATE == "Maharashtra"), 
       aes(MONTH, EFFORT.DISTANCE.KM, colour = COVID)) + 
  scale_y_log10() + scale_x_continuous(breaks = 1:12) + geom_smooth() +
  ggtitle("Maharashtra") +
  xlab("Month") + ylab("Distance travelled (km)")))

rm(dist_sw, dist_nw)

```

* At the national level, checklist distances were highest during summer and winter before the pandemic. During the pandemic, distances remained fairly similar for the winter months of October--December, but were drastically lower during the summer months of April and May, which coincided with the national lockdown.  
* In Kerala, before the pandemic, birders travelled longest in checklists during late summer and early winter and shortest in late winter and peak monsoon. This contrasts with the pattern seen in proportion of stationary lists (more stationary in early winter and less in late winter). This means that in early winter the lists were either stationary or travelling larger distances, while in late winter lists converged to shorter distances. With the pandemic, effort distances reduced in general, most strongly in late summer and early monsoon, coinciding with the national lockdown.  
* Karnataka didn't show differences between early and late winter, but February saw very short distances, most likely due to the global event GBBC, where people are advised to submit multiple 15-minute lists. Otherwise, effort distances remained fairly constant, with highest peaks in summer and winter. However, during the pandemic these patterns stayed the same except for the months of April and May due to the national lockdown.  
* In Gujarat the patterns were much more simple, with summer having short distance checklists and early winter having long distance lists. This could be because the months of August--October overlap with the arrival of huge numbers of passage migrants in Gujarat (most of these are uncommon birds and move on further outside India), attracting a lot of birding. Interestingly, there is no difference with the pandemic.  
* Once again, due to data scarcity, there is no clear pattern that can be identified from Arunachal Pradesh.


### Site fidelity per observer  

```{r fidelity, cache=TRUE, message=FALSE, echo=FALSE}

# not averaged by state 

fidel_nw <- data_sub %>% 
  group_by(SAMPLING.EVENT.IDENTIFIER) %>% 
  slice(1) %>% ungroup() %>% 
  mutate(COORD = paste0(round(LATITUDE, 2), ",", round(LONGITUDE, 2))) %>% #1kmx1km
  group_by(COVID, YEAR, MONTH, OBSERVER.ID) %>% 
  summarise(NO.SITES = n_distinct(COORD))

fidel_sw <- data_sub %>% 
  group_by(SAMPLING.EVENT.IDENTIFIER) %>% 
  slice(1) %>% ungroup() %>% 
  mutate(COORD = paste0(round(LATITUDE, 2), ",", round(LONGITUDE, 2))) %>% #1kmx1km
  group_by(COVID, YEAR, MONTH, STATE, OBSERVER.ID) %>% 
  summarise(NO.SITES = n_distinct(COORD))

(ggplot(fidel_nw, aes(MONTH, NO.SITES, colour = COVID)) + 
    scale_y_log10() + scale_x_continuous(breaks = 1:12) + 
    geom_smooth() +
    ggtitle("No. of sites visited by observers at national level")) /
((ggplot(filter(fidel_sw, STATE == "Kerala"), 
        aes(MONTH, NO.SITES, colour = COVID)) + 
    scale_y_log10() + scale_x_continuous(breaks = 1:12) + 
    geom_smooth() +
  ggtitle("Kerala")) |
(ggplot(filter(fidel_sw, STATE == "Karnataka"), 
        aes(MONTH, NO.SITES, colour = COVID)) + 
    scale_y_log10() + scale_x_continuous(breaks = 1:12) + 
    geom_smooth() +
  ggtitle("Karnataka"))) /
((ggplot(filter(fidel_sw, STATE == "Gujarat"), 
        aes(MONTH, NO.SITES, colour = COVID)) + 
    scale_y_log10() + scale_x_continuous(breaks = 1:12) + 
    geom_smooth() +
  ggtitle("Gujarat")) |
(ggplot(filter(fidel_sw, STATE == "Maharashtra"), 
        aes(MONTH, NO.SITES, colour = COVID)) + 
    scale_y_log10() + scale_x_continuous(breaks = 1:12) + 
    geom_smooth() +
  ggtitle("Maharashtra")))

# fidel_nw_bx <- fidel_nw %>% ungroup() %>% 
#   group_by(COVID, MONTH) %>% 
#   summarise(y0 = quantile(NO.SITES, 0.05),
#             y25 = quantile(NO.SITES, 0.25),
#             y50 = mean(NO.SITES),
#             y75 = quantile(NO.SITES, 0.75),
#             y100 = quantile(NO.SITES, 0.95))
# 
# ggplot(fidel_nw_bx, aes(as.factor(MONTH), fill = COVID)) + 
#   scale_y_log10() + 
#   geom_boxplot(aes(ymin = y0, lower = y25, middle = y50, upper = y75, ymax = y100),
#                stat = "identity") +
#   ggtitle("Site fidelity of observers at national level")
  
rm(list = c("fidel_nw","fidel_sw"))

```

* Smooths were used instead of boxplots because the latter was proving uninformative, due to high right skew (1-inflation). I feel smooths explain the patterns better.  
* At the national level, site fidelity was generally higher during the pandemic than before in all months. However, April and May were drastically different due to the national lockdown, and saw very high site fidelity (i.e., very low number of sites visited).  
* This pattern was present in the states of Kerala and Karnataka as well, but in Karnataka the winter months were similar in the two periods, if not DURING having lower site fidelity than BEFORE.  
* In Gujarat, the difference wasn't great, and site fidelity even seems to be lower during the pandemic, possibly due to growth in eBirding in the state.  
* Arunachal Pradesh has insufficient data to make conclusions from.


### Birding time per observer

```{r time, cache=TRUE, message=FALSE, echo=FALSE}

time_nw <- data_sub %>% 
  group_by(SAMPLING.EVENT.IDENTIFIER) %>% 
  slice(1) %>% ungroup() %>% 
  group_by(COVID, YEAR, MONTH, OBSERVER.ID) %>% 
  summarise(B.TIME = sum(DURATION.MINUTES))

time_sw <- data_sub %>% 
  group_by(SAMPLING.EVENT.IDENTIFIER) %>% 
  slice(1) %>% ungroup() %>% 
  group_by(COVID, YEAR, MONTH, STATE, OBSERVER.ID) %>% 
  summarise(B.TIME = sum(DURATION.MINUTES))


(ggplot(time_nw, aes(MONTH, B.TIME, colour = COVID)) + 
    scale_x_continuous(breaks = 1:12) + 
    geom_smooth() +
    ggtitle("Monthly birding times of observers at national level")) 


((ggplot(filter(time_sw, STATE == "Kerala"), aes(MONTH, B.TIME, colour = COVID)) + 
    scale_x_continuous(breaks = 1:12) + 
    geom_smooth() +
    ggtitle("Kerala")) |
(ggplot(filter(time_sw, STATE == "Karnataka"), aes(MONTH, B.TIME, colour = COVID)) + 
    scale_x_continuous(breaks = 1:12) + 
    geom_smooth() +
    ggtitle("Karnataka"))) /
((ggplot(filter(time_sw, STATE == "Gujarat"), aes(MONTH, B.TIME, colour = COVID)) + 
    scale_x_continuous(breaks = 1:12) + 
    geom_smooth() +
    ggtitle("Gujarat")) |
(ggplot(filter(time_sw, STATE == "Maharashtra"), aes(MONTH, B.TIME, colour = COVID)) + 
    scale_x_continuous(breaks = 1:12) + 
    geom_smooth() +
    ggtitle("Maharashtra")))

rm(time_nw, time_sw, time_nw_bx, time_sw_bx)

```

* At the national level, birding times were and are higher in the winter, but during the pandemic decreased slightly in all months and drastically during the national lockdown.  
* In Kerala, pre-COVID birding times per observer showed a massive dip during the monsoon, even compared to the neighbouring state Karnataka where the monsoon is not as strong (dip nonexistent in Gujarat). The relatively low average birding time indicates that Kerala has several eBirders who do little birding.  
* In Karnataka, winter birding times per observer increased during the pandemic, either due to "behavioural release" from COVID restrictions, or due to greater interest/effort in winter migrants generated via other outreach initiatives(?).  
* In Gujarat the pattern was the opposite. Birding times decreased slightly during the national lockdown as well as during early winter. 

### List duration

```{r duration, cache=TRUE, message=FALSE, echo=FALSE}

dur_sw <- data_sub %>% 
  group_by(SAMPLING.EVENT.IDENTIFIER) %>% 
  slice(1) %>% ungroup() %>% 
  group_by(COVID, YEAR, MONTH, STATE) %>% 
  summarise(DURATION.MINUTES = ceiling(mean(DURATION.MINUTES))) %>%
  ungroup() 

dur_nw <- dur_sw %>% 
  group_by(COVID, YEAR, MONTH) %>% 
  summarise(DURATION.MINUTES = ceiling(mean(DURATION.MINUTES))) %>% 
  ungroup()

(ggplot(dur_nw, aes(MONTH, DURATION.MINUTES, colour = COVID)) + 
  scale_y_log10() + scale_x_continuous(breaks = 1:12) + geom_smooth() +
  ggtitle("Average checklist duration at national level")) /
((ggplot(filter(dur_sw, STATE == "Kerala"), 
       aes(MONTH, DURATION.MINUTES, colour = COVID)) + 
  scale_y_log10() + scale_x_continuous(breaks = 1:12) + geom_smooth() +
  ggtitle("Kerala")) |
(ggplot(filter(dur_sw, STATE == "Karnataka"), 
       aes(MONTH, DURATION.MINUTES, colour = COVID)) + 
  scale_y_log10() + scale_x_continuous(breaks = 1:12) + geom_smooth() +
  ggtitle("Karnataka"))) /
((ggplot(filter(dur_sw, STATE == "Gujarat"), 
       aes(MONTH, DURATION.MINUTES, colour = COVID)) + 
  scale_y_log10() + scale_x_continuous(breaks = 1:12) + geom_smooth() +
  ggtitle("Gujarat")) |
(ggplot(filter(dur_sw, STATE == "Maharashtra"), 
       aes(MONTH, DURATION.MINUTES, colour = COVID)) + 
  scale_y_log10() + scale_x_continuous(breaks = 1:12) + geom_smooth() +
  ggtitle("Maharashtra")))

rm(dur_sw, dur_nw)

```

* In normal circumstances, checklists become longer in the winter, and shorter during February (probably due to GBBC) and July--August (monsoon). The most striking change during the pandemic was the extremely low checklist duration in April--June, due to the national lockdown.  
* In Kerala, while most of the pattern remains similar before and during the pandemic, the strong dip in checklist duration during the national lockdown is still present. Moreover, the winter months during the pandemic saw longer checklists than before.  
* Karnataka before the pandemic showed strange patterns in terms of checklist duration, alternating with every month. During the pandemic, the fluctuation disappeared, but although the months of April and May had shortest checklist compared to other months, it wasn't very different from the average duration before the pandemic.  
* In Gujarat checklist duration decreased in all months with pandemic, except for January which could be because of tourists arriving in search of migrants(?). Duration was lowest during lockdown months.  
* Arunachal Pradesh has insufficient data.  
* A point of interest is that the average checklist duration varied greatly between states. Among the 4 compared here, Kerala on average had shortest lists, followed by Karnataka and then Gujarat.  

### List length

```{r length, cache=TRUE, message=FALSE, echo=FALSE}

length_sw <- data_sub %>% 
  mutate(CATEGORY == case_when(CATEGORY == "domestic" & 
                                 COMMON.NAME == "Rock Pigeon" ~ "species",
                               TRUE ~ CATEGORY)) %>% 
  filter(CATEGORY %in% c("issf","species")) %>% 
  group_by(COVID, YEAR, MONTH, STATE, SAMPLING.EVENT.IDENTIFIER) %>% 
  summarise(LENGTH = n_distinct(COMMON.NAME)) %>% ungroup() %>% 
  group_by(COVID, YEAR, MONTH, STATE) %>% 
  summarise(LENGTH = ceiling(mean(LENGTH))) %>% 
  ungroup()

length_nw <- length_sw %>% 
  group_by(COVID, YEAR, MONTH) %>% 
  summarise(LENGTH = ceiling(mean(LENGTH))) %>% 
  ungroup()

(ggplot(length_nw, aes(MONTH, LENGTH, colour = COVID)) + 
  scale_y_log10() + scale_x_continuous(breaks = 1:12) + geom_smooth() +
  ggtitle("Average checklist length at national level")) /
((ggplot(filter(length_sw, STATE == "Kerala"), 
       aes(MONTH, LENGTH, colour = COVID)) + 
  scale_y_log10() + scale_x_continuous(breaks = 1:12) + geom_smooth() +
  ggtitle("Kerala")) |
(ggplot(filter(length_sw, STATE == "Karnataka"), 
       aes(MONTH, LENGTH, colour = COVID)) + 
  scale_y_log10() + scale_x_continuous(breaks = 1:12) + geom_smooth() +
  ggtitle("Karnataka"))) /
((ggplot(filter(length_sw, STATE == "Gujarat"), 
       aes(MONTH, LENGTH, colour = COVID)) + 
  scale_y_log10() + scale_x_continuous(breaks = 1:12) + geom_smooth() +
  ggtitle("Gujarat")) |
(ggplot(filter(length_sw, STATE == "Maharashtra"), 
       aes(MONTH, LENGTH, colour = COVID)) + 
  scale_y_log10() + scale_x_continuous(breaks = 1:12) + geom_smooth() +
  ggtitle("Maharashtra")))

rm(length_nw, length_sw)

```

* The smooth is giving very different results from the boxplots. Hence, decided to use only boxplots.  
* There is no discernible pattern in checklist length with the pandemic or with seasons, although it seems that the average checklist becomes bigger in the winter (due to winter migrants adding to the local species pool).


### Habitats surveyed  

### Spatial spread  

```{r s_spread_1, cache=TRUE, message=FALSE, echo=FALSE, eval=FALSE}

library(sp)
library(rgdal)

india <- readOGR(dsn = "data/in_2011", layer = "India_2011")
states <- readOGR(dsn = "data/in_states_2019", layer = "in_states_2019")

load("data/maps.RData")
load("data/clips.RData")

data_sp <- data_sub %>% 
  group_by(SAMPLING.EVENT.IDENTIFIER) %>% 
  slice(1) %>% ungroup() 

temp <- data_sp %>% column_to_rownames("SAMPLING.EVENT.IDENTIFIER") 
coordinates(temp) <- ~LONGITUDE + LATITUDE 
proj4string(temp) <- "+proj=longlat +datum=WGS84"
temp <- temp %>% over(districtmap) %>%
  select(1:2) %>% rownames_to_column("SAMPLING.EVENT.IDENTIFIER") 
data_sp <- left_join(temp, data_sp)
  
# add columns with GRID ATTRIBUTES to main data
temp <- data_sp %>% group_by(SAMPLING.EVENT.IDENTIFIER) %>% slice(1)
temp <- temp %>% column_to_rownames("SAMPLING.EVENT.IDENTIFIER")
coordinates(temp) <- ~LONGITUDE + LATITUDE
temp <- temp %>% over(gridmapg1) %>% rownames_to_column("SAMPLING.EVENT.IDENTIFIER") 
data_sp <- left_join(temp, data_sp)
names(data_sp)[2] <- "GRIDG1"

temp <- data_sp %>% group_by(SAMPLING.EVENT.IDENTIFIER) %>% slice(1)
temp <- temp %>% column_to_rownames("SAMPLING.EVENT.IDENTIFIER")
coordinates(temp) <- ~LONGITUDE + LATITUDE
temp <- temp %>% over(g2clip) %>% rownames_to_column("SAMPLING.EVENT.IDENTIFIER") 
data_sp <- left_join(temp, data_sp)
names(data_sp)[2] <- "G2CLIP"
```

```{r s_spread_cov, cache=TRUE, message=FALSE, echo=FALSE, eval=FALSE}

data_cov <- data_sp %>% 
  ungroup() %>% 
  mutate(TOT.GRIDS = n_distinct(GRIDG1)) %>% 
  group_by(COVID, YEAR, MONTH, GRIDG1) %>% 
  summarise(NO.LISTS = n_distinct(SAMPLING.EVENT.IDENTIFIER),
            TOT.GRIDS = min(TOT.GRIDS)) %>% 
  ungroup() %>% 
  group_by(COVID, YEAR, MONTH) %>% 
  summarise(SD.LISTS = sd(NO.LISTS),
            TOT.GRIDS = min(TOT.GRIDS),
            NO.GRIDS = n_distinct(GRIDG1),
            PROP.GRIDS = round(NO.GRIDS/TOT.GRIDS,2))

ggplot(data_cov, aes(as.factor(MONTH), SD.LISTS, colour = COVID)) + 
   geom_point(stat = "summary", fun.data = mean_cl_boot, 
              size = 4, position = position_dodge(0.5)) +
   geom_errorbar(stat = 'summary', fun.data = mean_cl_boot, 
                 size = 1.25, width = 0.3, position = position_dodge(0.5)) +
   xlab("Month") + ylab("Standard deviation of lists across cells")

ggplot(data_cov, aes(as.factor(MONTH), PROP.GRIDS, colour = COVID)) + 
   geom_point(stat = "summary", fun.data = mean_cl_boot, 
              size = 4, position = position_dodge(0.5)) +
   geom_errorbar(stat = 'summary', fun.data = mean_cl_boot, 
                 size = 1.25, width = 0.3, position = position_dodge(0.5)) +
   xlab("Month") + ylab("Proportion of cells with birding activity")

ggplot(data_cov, aes(as.factor(MONTH), NO.GRIDS, colour = COVID)) + 
   geom_point(stat = "summary", fun.data = mean_cl_boot, 
              size = 4, position = position_dodge(0.5)) +
   geom_errorbar(stat = 'summary', fun.data = mean_cl_boot, 
                 size = 1.25, width = 0.3, position = position_dodge(0.5)) +
   xlab("Month") + ylab("Number of cells with birding activity")

```

```{r s_spread_city, cache=TRUE, message=FALSE, echo=FALSE, eval=FALSE}

blr <- readOGR(dsn = "data/boundaries_IN_metro/Bangalore", 
               layer = "Bangalore Divisions")

plot(blr)

```

```{r s_spread_map, cache=TRUE, message=FALSE, echo=FALSE, eval=FALSE}

data_map <- data_sp %>% 
  ungroup() %>% 
  group_by(COVID, G2CLIP) %>% 
  summarise(NO.LISTS = n_distinct(SAMPLING.EVENT.IDENTIFIER)) %>% 
  mutate(id = paste0("g",G2CLIP)) %>% 
  right_join(fortify(g2clip))

ggplot() +
  geom_polygon(data = fortify(india), 
               aes(long, lat, group = group),
               fill = NA, colour = "black", lwd = 1) +
  geom_polygon(data = filter(data_map, COVID == "BEF"), 
               aes(long, lat, group = group, fill = log(NO.LISTS)),
               colour = NA, lwd = 0.5) +
  scale_fill_distiller(palette = "Reds", direction = 1)


ggplot() +
  geom_polygon(data = fortify(india), 
               aes(long, lat, group = group),
               fill = NA, colour = "black", lwd = 1) +
  geom_polygon(data = filter(data_map, COVID == "DUR"), 
               aes(long, lat, group = group, fill = log(NO.LISTS)),
               colour = NA, lwd = 0.5) +
  scale_fill_distiller(palette = "Reds", direction = 1)


```


```{r s_spread_LULC, cache=TRUE, message=FALSE, echo=FALSE, eval=FALSE}

library(raster)

x <- raster("data/in_LULC/data/LULC_2005.tif")
y <- rasterToPolygons(x)


```


### Temporal spread

```{r t_spread_1, cache=TRUE, message=FALSE, echo=FALSE}

temp1 <- data_sub %>% 
  group_by(SAMPLING.EVENT.IDENTIFIER) %>% 
  slice(1) %>% ungroup() %>% 
  mutate(DAYW = wday(OBSERVATION.DATE, 
                     week_start = getOption("lubridate.week.start", 1)),
         TIMED = hour(as_datetime(paste(OBSERVATION.DATE,
                                              TIME.OBSERVATIONS.STARTED)))) 

t_dow_sw <- temp1 %>% group_by(COVID, YEAR, MONTH, DAYW, STATE) %>% 
  summarise(NO.LISTS = n_distinct(SAMPLING.EVENT.IDENTIFIER)) %>%  
  ungroup() %>% group_by(COVID) %>% 
  complete(YEAR, MONTH, STATE, DAYW, fill = list(NO.LISTS = 0)) %>%
  ungroup() %>% group_by(COVID, YEAR, MONTH, STATE) %>% 
  summarise(DAYW = DAYW, NO.LISTS = NO.LISTS, M.LISTS = sum(NO.LISTS)) %>% 
  mutate(PROP.LISTS = round(NO.LISTS/M.LISTS,2))

t_dow_nw <- t_dow_sw %>% ungroup() %>% 
  group_by(COVID, YEAR, MONTH, DAYW) %>% 
  summarise(NO.LISTS = ceiling(mean(NO.LISTS))) %>% 
  ungroup() %>% 
  group_by(COVID, YEAR, MONTH) %>% 
  summarise(DAYW = DAYW, NO.LISTS = NO.LISTS, M.LISTS = sum(NO.LISTS)) %>% 
  mutate(PROP.LISTS = round(NO.LISTS/M.LISTS,2))
  
t_tod_sw <- temp1 %>% group_by(COVID, YEAR, MONTH, TIMED, STATE) %>% 
  summarise(NO.LISTS = n_distinct(SAMPLING.EVENT.IDENTIFIER), COVID = min(COVID)) %>%  
  ungroup() %>% group_by(COVID) %>% 
  complete(YEAR, MONTH, STATE, TIMED, fill = list(NO.LISTS = 0)) %>%
  ungroup() %>% group_by(COVID, YEAR, MONTH, STATE) %>% 
  summarise(TIMED = TIMED, NO.LISTS = NO.LISTS, M.LISTS = sum(NO.LISTS)) %>% 
  mutate(PROP.LISTS = round(NO.LISTS/M.LISTS,2))
  
t_tod_nw <- t_tod_sw %>% ungroup() %>% 
  group_by(COVID, YEAR, MONTH, TIMED) %>% 
  summarise(NO.LISTS = ceiling(mean(NO.LISTS))) %>% 
  ungroup() %>% 
  group_by(COVID, YEAR, MONTH) %>% 
  summarise(TIMED = TIMED, NO.LISTS = NO.LISTS, M.LISTS = sum(NO.LISTS)) %>% 
  mutate(PROP.LISTS = round(NO.LISTS/M.LISTS,2))

# Daman and Diu issue

```

#### Day-of-week

```{r t_spread_2, cache=TRUE, message=FALSE, echo=FALSE}

ggplot(t_dow_nw, aes(as.factor(DAYW), PROP.LISTS, colour = COVID)) + 
   geom_point(stat = "summary", fun.data = mean_cl_boot, 
              size = 4, position = position_dodge(0.5)) +
   geom_errorbar(stat = 'summary', fun.data = mean_cl_boot, 
                 size = 1.25, width = 0.3, position = position_dodge(0.5)) +
   xlab("Day") + ylab("Proportion of lists")

```

* At the national level, Friday, Saturday and Sunday see the highest birding activity, and this remained the same even during the pandemic. Although weekend birding decreased marginally, it is not a strong enough shift. (Note that boxplot uses median, not mean.)  

```{r t_spread_3, cache=TRUE, message=FALSE, echo=FALSE}

((ggplot(filter(t_dow_sw, STATE == "Kerala"), 
       aes(as.factor(DAYW), PROP.LISTS, colour = COVID)) + 
   geom_point(stat = "summary", fun.data = mean_cl_boot, 
              size = 2, position = position_dodge(0.5)) +
   geom_errorbar(stat = 'summary', fun.data = mean_cl_boot, 
                 size = 1.25, width = 0.3, position = position_dodge(0.5)) +
   xlab("Day") + ylab("Proportion of lists") +
    ggtitle("Kerala") |
ggplot(filter(t_dow_sw, STATE == "Karnataka"), 
       aes(as.factor(DAYW), PROP.LISTS, colour = COVID)) + 
   geom_point(stat = "summary", fun.data = mean_cl_boot, 
              size = 2, position = position_dodge(0.5)) +
   geom_errorbar(stat = 'summary', fun.data = mean_cl_boot, 
                 size = 1.25, width = 0.3, position = position_dodge(0.5)) +
   xlab("Day") + ylab("Proportion of lists") +
    ggtitle("Karnataka") ) /
(ggplot(filter(t_dow_sw, STATE == "Gujarat"), 
       aes(as.factor(DAYW), PROP.LISTS, colour = COVID)) + 
   geom_point(stat = "summary", fun.data = mean_cl_boot, 
              size = 2, position = position_dodge(0.5)) +
   geom_errorbar(stat = 'summary', fun.data = mean_cl_boot, 
                 size = 1.25, width = 0.3, position = position_dodge(0.5)) +
   xlab("Day") + ylab("Proportion of lists") +
   ggtitle("Gujarat")  |
ggplot(filter(t_dow_sw, STATE == "Maharashtra"), 
       aes(as.factor(DAYW), PROP.LISTS, colour = COVID)) + 
   geom_point(stat = "summary", fun.data = mean_cl_boot, 
              size = 2, position = position_dodge(0.5)) +
   geom_errorbar(stat = 'summary', fun.data = mean_cl_boot, 
                 size = 1.25, width = 0.3, position = position_dodge(0.5)) +
   xlab("Day") + ylab("Proportion of lists") +
    ggtitle("Maharashtra") ))

```

* The states of Kerala and Karnataka also show pretty much the same pattern as the national level, with minor differences.  
* Thus, the pandemic did not influence the amount of birding done on particular days of the week.

#### Time-of-day

```{r t_spread_4, cache=TRUE, message=FALSE, echo=FALSE}

ggplot(t_tod_nw, aes(as.factor(TIMED), PROP.LISTS, colour = COVID)) + 
   geom_point(stat = "summary", fun.data = mean_cl_boot, 
              size = 4, position = position_dodge(0.5)) +
   geom_errorbar(stat = 'summary', fun.data = mean_cl_boot, 
                 size = 1.25, width = 0.3, position = position_dodge(0.5)) +
   xlab("Day") + ylab("Proportion of lists")

```

* At the national level, there are two peaks in the day that see highest birding activity: early morning and evening. This did not change with the pandemic. (Note that boxplot uses median, not mean.)  

```{r t_spread_5, cache=TRUE, message=FALSE, echo=FALSE}

((ggplot(filter(t_tod_sw, STATE == "Kerala"), 
       aes(as.factor(TIMED), PROP.LISTS, colour = COVID)) + 
   geom_point(stat = "summary", fun.data = mean_cl_boot, 
              size = 2, position = position_dodge(0.5)) +
   geom_errorbar(stat = 'summary', fun.data = mean_cl_boot, 
                 size = 1.25, width = 0.3, position = position_dodge(0.5)) +
   xlab("Day") + ylab("Proportion of lists") +
    ggtitle("Kerala") |
ggplot(filter(t_tod_sw, STATE == "Karnataka"), 
       aes(as.factor(TIMED), PROP.LISTS, colour = COVID)) + 
   geom_point(stat = "summary", fun.data = mean_cl_boot, 
              size = 2, position = position_dodge(0.5)) +
   geom_errorbar(stat = 'summary', fun.data = mean_cl_boot, 
                 size = 1.25, width = 0.3, position = position_dodge(0.5)) +
   xlab("Day") + ylab("Proportion of lists") +
    ggtitle("Karnataka") ) /
(ggplot(filter(t_tod_sw, STATE == "Gujarat"), 
       aes(as.factor(TIMED), PROP.LISTS, colour = COVID)) + 
   geom_point(stat = "summary", fun.data = mean_cl_boot, 
              size = 2, position = position_dodge(0.5)) +
   geom_errorbar(stat = 'summary', fun.data = mean_cl_boot, 
                 size = 1.25, width = 0.3, position = position_dodge(0.5)) +
   xlab("Day") + ylab("Proportion of lists") +
   ggtitle("Gujarat")  |
ggplot(filter(t_tod_sw, STATE == "Maharashtra"), 
       aes(as.factor(TIMED), PROP.LISTS, colour = COVID)) + 
   geom_point(stat = "summary", fun.data = mean_cl_boot, 
              size = 2, position = position_dodge(0.5)) +
   geom_errorbar(stat = 'summary', fun.data = mean_cl_boot, 
                 size = 1.25, width = 0.3, position = position_dodge(0.5)) +
   xlab("Day") + ylab("Proportion of lists") +
    ggtitle("Maharashtra") ))


rm(list = c("temp1","t_dow_nw","t_dow_sw","t_tod_nw","t_tod_sw"))

```

* The states of Kerala and Karnataka also show pretty much the same pattern as the national level, with minor differences between them.  
* Thus, the pandemic did not influence the amount of birding done at different times of the day.

### Media

```{r media, cache=TRUE, message=FALSE, echo=FALSE}

# not averaged by state

media_nw <- data_sub %>% 
  group_by(SAMPLING.EVENT.IDENTIFIER) %>% 
  slice(1) %>% ungroup() %>% 
  filter(HAS.MEDIA == 1) %>% 
  group_by(COVID, YEAR, MONTH) %>% 
  summarise(NO.LISTS = n_distinct(SAMPLING.EVENT.IDENTIFIER)) 

media_sw <- data_sub %>% 
  group_by(SAMPLING.EVENT.IDENTIFIER) %>% 
  slice(1) %>% ungroup() %>% 
  filter(HAS.MEDIA == 1) %>% 
  group_by(COVID, YEAR, MONTH, STATE) %>% 
  summarise(NO.LISTS = n_distinct(SAMPLING.EVENT.IDENTIFIER)) 

# Daman and Diu lists not appearing from 2020--2021


(ggplot(media_nw, aes(MONTH, NO.LISTS, colour = COVID)) + 
  scale_x_continuous(breaks = 1:12) + geom_point(size = 2) +
  ggtitle("Proportion of stationary lists at national level")) 

((ggplot(filter(media_sw, STATE == "Kerala"), 
         aes(MONTH, NO.LISTS, colour = COVID)) + 
  scale_x_continuous(breaks = 1:12) + geom_point(size = 2) +
  ggtitle("Kerala")) |
(ggplot(filter(media_sw, STATE == "Karnataka"), 
        aes(MONTH, NO.LISTS, colour = COVID)) + 
  scale_x_continuous(breaks = 1:12) + geom_point(size = 2) +
  ggtitle("Karnataka"))) /
((ggplot(filter(media_sw, STATE == "Gujarat"), 
         aes(MONTH, NO.LISTS, colour = COVID)) + 
  scale_x_continuous(breaks = 1:12) + geom_point(size = 2) +
  ggtitle("Gujarat")) |
(ggplot(filter(media_sw, STATE == "Maharashtra"), 
        aes(MONTH, NO.LISTS, colour = COVID)) + 
  scale_x_continuous(breaks = 1:12) + geom_point(size = 2) +
  ggtitle("Maharashtra")))

rm(list = c("media_nw","media_sw"))

```

* At the national level, there are more lists with media during the winter than in other periods of the year. During the pandemic, lists with media have seemingly increased a little, most likely due to overall growth in eBirding.  
* At the state level, Kerala and Karnataka have decent and similar numbers of lists with media. Kerala has a stonger mid-year dip than Karnataka, while the latter shows a relatively greater increase in lists with media during the pandemic. Other states like Gujarat and Arunachal Pradesh have few such lists, making conclusions difficult.  



### New birders

```{r new, cache=TRUE, message=FALSE, echo=FALSE}

load("data/new_obsr_data.RData")

new_obsr_nw <- new_obsr_data %>% 
  filter(COVID != "NA") %>% 
  group_by(COVID, LE.YEAR, LE.MONTH) %>% 
  summarise(NEW = n_distinct(OBSERVER.ID))

# not new to the state, but new overall, just grouped by state of first eBirding
new_obsr_sw <- new_obsr_data %>% 
  filter(COVID != "NA") %>% 
  group_by(COVID, LE.YEAR, LE.MONTH, STATE) %>% 
  summarise(NEW = n_distinct(OBSERVER.ID))


(ggplot(new_obsr_nw, aes(LE.MONTH, NEW, colour = COVID)) + 
    scale_x_continuous(breaks = 1:12) + scale_y_log10() +
    geom_point(size = 2) +
    ggtitle("Monthly number of new eBirders at national level")) /
((ggplot(filter(new_obsr_sw, STATE == "Kerala"), 
         aes(LE.MONTH, NEW, colour = COVID)) + 
    scale_x_continuous(breaks = 1:12) + scale_y_log10() +
    geom_point(size = 2) +
    ggtitle("Kerala"))  |
(ggplot(filter(new_obsr_sw, STATE == "Karnataka"), 
         aes(LE.MONTH, NEW, colour = COVID)) + 
    scale_x_continuous(breaks = 1:12) + scale_y_log10() +
    geom_point(size = 2) +
    ggtitle("Karnataka"))) /
((ggplot(filter(new_obsr_sw, STATE == "Gujarat"), 
         aes(LE.MONTH, NEW, colour = COVID)) + 
    scale_x_continuous(breaks = 1:12) + scale_y_log10() +
    geom_point(size = 2) +
    ggtitle("Gujarat")) |
(ggplot(filter(new_obsr_sw, STATE == "Maharashtra"), 
         aes(LE.MONTH, NEW, colour = COVID)) + 
    scale_x_continuous(breaks = 1:12) + scale_y_log10() +
    geom_point(size = 2) +
    ggtitle("Maharashtra")))


# Gujarat and ArP showing zero eBirders in certain cases. Probably due to random subsampling.


rm(list = c("new_obsr_nw","new_obsr_sw"))

```

* At the national level, the pandemic has seen a greater number of monthly new eBirders than before, presumably due to greater frequency and impact of outreach initiatives. The dip in monthly new eBirders during the monsoon, which was seen before the pandemic, has also disappeared in 2020--21.  
* While Kerala and Karnataka both have seen increases in monthly new eBirders with the pandemic, the increase is more striking in Karnataka than in Kerala. 


# References

